<!DOCTYPE html>
<html lang="en">
    <head>
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <meta http-equiv="content-type" content="text/html; charset=utf-8">

      <!-- Enable responsiveness on mobile devices-->
      <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

      <title></title>

      

      
          <link rel="stylesheet" href="https://wonkwh.github.io/site.css">
      

      
      
    </head>

    <body class="hack dark main container">
        

<article itemscope itemtype="http://schema.org/BlogPosting">
    <header>
        <h1 itemprop="headline">fluid interface effect</h1>
        <span class="muted">
    <svg style="margin-bottom:-3px" class="i-clock" viewBox="0 0 32 32"
         width="16" height="16" fill="none" stroke="currentcolor"
         stroke-linecap="round" stroke-linejoin="round" stroke-width="6.25%">
        <circle cx="16" cy="16" r="14"/>
        <path d="M16 8 L16 16 20 20"/>
    </svg>
    <span>3 minute read</span>
    <svg style="margin-bottom: -3px" class="i-edit" viewBox="0 0 32 32"
         width="16" height="16" fill="none" stroke="currentcolor"
         stroke-linecap="round" stroke-linejoin="round" stroke-width="6.25%">
        <path d="M30 7 L25 2 5 22 3 29 10 27 Z M21 6 L26 11 Z M5 22 L10 27 Z"/>
    </svg>

    Published: 2019-11-27
</span>
    </header>
    <div itemprop="articleBody">
      <p>wwdc2018 세션중 하나인 <a href="https://developer.apple.com/videos/play/wwdc2018/803/">Designing Fluid Interfaces</a> 를 직접 구현한 opensource중 button 구현에 대해 정리</p>
<ul>
<li><a href="https://github.com/nathangitter/fluid-interfaces">fluid-interfaces</a></li>
</ul>
<span id="continue-reading"></span><h3 id="ios-appjung-gyesangiaebyi-beoteungwa-gateun-hyogwa">ios app중 계산기앱의 버튼과 같은 효과</h3>
<ul>
<li>Button구현의 풀소스는 다음과 같다 </li>
</ul>
<pre data-lang="swift" class="language-swift "><code class="language-swift" data-lang="swift">&#x2F;&#x2F;
&#x2F;&#x2F;  Button.swift
&#x2F;&#x2F;  Example
&#x2F;&#x2F;
&#x2F;&#x2F;  Created by kwanghyun.won on 2019&#x2F;11&#x2F;07.
&#x2F;&#x2F;  Copyright © 2019 vingle. All rights reserved.
&#x2F;&#x2F;

import UIKit

open class Button: UIButton {
    private struct Const {
        static let borderWidth: CGFloat = 1
        static let cornerRadius: CGFloat = 2
    }

    open override var intrinsicContentSize: CGSize {
        var origSize = super.intrinsicContentSize
        origSize.height = self.size == .large ? origSize.height + 4.0 : origSize.height + 2.0
        &#x2F;&#x2F;dump(origSize)
        return origSize
    }

    open override func tintColorDidChange() {
        super.tintColorDidChange()
        update()
    }

    open var style: ButtonStyle = .flat {
        didSet {
            if style != oldValue {
                update()
            }
        }
    }

    open var size: ButtonSize = .large {
        didSet {
            if size != oldValue {
                update()
            }
        }
    }

    open override var isHighlighted: Bool {
        didSet {
            if isHighlighted != oldValue {
                update()
            }
        }
    }

    open override var isEnabled: Bool {
        didSet {
            if isEnabled != oldValue {
                update()
            }
        }
    }

    private var animator = UIViewPropertyAnimator()
    private let activationFeedBackGenerator = UIImpactFeedbackGenerator(style: .light)

    public init(style: ButtonStyle = .flat, size: ButtonSize = .large) {
        self.style = style
        self.size = size
        super.init(frame: .zero)
        initialize()
    }
    
    public override init(frame: CGRect) {
        super.init(frame: frame)
        initialize()
    }

    public required init?(coder aDecoder: NSCoder) {
        super.init(coder: aDecoder)
        initialize()
    }

    open override func layoutSubviews() {
        super.layoutSubviews()
        layer.cornerRadius = Const.cornerRadius
        layer.borderWidth = style == .ghost ? Const.borderWidth : 0.0
    }

    func initialize() {
        update()
        NotificationCenter.default.addObserver(self, selector: #selector(didContentSizeCategoryDidChange),
                                               name: UIContentSizeCategory.didChangeNotification, object: nil)
        addTarget(self, action: #selector(didTouchDown), for: [.touchDown, .touchDragEnter])
        addTarget(self, action: #selector(didTouchUp), for: [.touchUpInside, .touchDragExit, .touchCancel])
    }

    private func update() {
        setTitleColor(style.titleColor, for: .normal)
        setTitleColor(style.hightlightTitleColor, for: .highlighted)
        setTitleColor(style.disableTitleColor, for: .disabled)

        self.backgroundColor = isEnabled ? style.backgroundColor : style.disableBackgroundColor

        layer.borderColor = isEnabled ? style.titleColor.cgColor : style.disableTitleColor.cgColor

        titleLabel?.font = size.titleFont
        let lineHeight: CGFloat = (size == .large) ? 22.0 : 19.0
        titleLabel?.setLineHeight(lineHeight: lineHeight)

        contentEdgeInsets = size.contentEdgeInsets
    }

}

&#x2F;&#x2F; MARK: - event
extension Button {
    @objc private func didContentSizeCategoryDidChange() {
        update()
    }

    @objc private func didTouchDown() {
        animator.stopAnimation(true)
        backgroundColor = style.hightlightBackgroundColor
        layer.borderColor = Colors.Button.borderHighlighted.cgColor
        activationFeedBackGenerator.impactOccurred()
    }

    @objc private func didTouchUp() {
        animator = UIViewPropertyAnimator(duration: 0.5, curve: .easeOut, animations: {
            self.backgroundColor = self.style.backgroundColor
            self.layer.borderColor = Colors.Button.border.cgColor
        })
        animator.startAnimation()
    }
}

</code></pre>
<ul>
<li>위소스중 계산기 버튼과 같은 효과를 주기위한 효과는 </li>
</ul>
<pre data-lang="swift" class="language-swift "><code class="language-swift" data-lang="swift">private var animator = UIViewPropertyAnimator()
&#x2F;&#x2F;&#x2F;...

    @objc private func didTouchDown() {
        animator.stopAnimation(true)
        backgroundColor = style.hightlightBackgroundColor
        &#x2F;&#x2F;..
    }

    @objc private func didTouchUp() {
        animator = UIViewPropertyAnimator(duration: 0.5, curve: .easeOut, animations: {
            self.backgroundColor = self.style.backgroundColor
            self.layer.borderColor = Colors.Button.border.cgColor
        })
        animator.startAnimation()
    }

</code></pre>
<h2 id="flashlight-button-gwa-gateun-hwagdae-cugso-aenimeisyeongwa-jindong-feedback">flashlight button 과 같은 확대,축소 애니메이션과 진동 feedback</h2>
<pre><code>위 버튼 구현 소스에는 확대,축소 애니메이션은 구현되어 있지 않다 
</code></pre>
<ul>
<li>진동 피드백 효과</li>
</ul>
<pre data-lang="swift" class="language-swift "><code class="language-swift" data-lang="swift">
    private let activationFeedBackGenerator = UIImpactFeedbackGenerator(style: 
    .light)
    &#x2F;&#x2F;...
    @objc private func didTouchDown() {
        activationFeedBackGenerator.impactOccurred()
    }
</code></pre>
<ul>
<li>확대,축소 효과를 주려면 아래 코드를 추가하면 된다. </li>
</ul>
<pre data-lang="swift" class="language-swift "><code class="language-swift" data-lang="swift"> private func animate() {
        let timingParameters = UISpringTimingParameters(damping: 0.4, response: 0.2)
        let animator = UIViewPropertyAnimator(duration: 0, timingParameters: timingParameters)
        animator.addAnimations {
            self.transform = CGAffineTransform(scaleX: 1, y: 1)
            self.backgroundColor = self.isOn ? self.onColor : self.offColor
        }
        animator.isInterruptible = true
        animator.startAnimation()
    }
</code></pre>

    </div>

    
        <footer>
            <hr>
            <p>
                
                    Published by Kwanghyun Won
                
                
                
                    and tagged
                    
                        <a href="https://wonkwh.github.io/tags/swift/">swift</a>
                        
                            
                                
                                    ,
                                
                            
                        
                    
                        <a href="https://wonkwh.github.io/tags/uikit/">uikit</a>
                        
                            
                                
                                    ,
                                
                            
                        
                    
                        <a href="https://wonkwh.github.io/tags/animation/">animation</a>
                        
                            
                                
                                    and
                                
                            
                        
                    
                        <a href="https://wonkwh.github.io/tags/wwdc/">wwdc</a>
                        
                            
                        
                    
                
            </p>
        </footer>
    
</article>


    </body>

</html>
