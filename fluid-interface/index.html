<!DOCTYPE html>
<html lang="en">
    <head>
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <meta http-equiv="content-type" content="text/html; charset=utf-8">

      <!-- Enable responsiveness on mobile devices-->
      <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

      <title></title>

      

      
          <link rel="stylesheet" href="https://wonkwh.github.io/site.css">
      

      
      
    </head>

    <body class="hack dark main container">
        

<article itemscope itemtype="http://schema.org/BlogPosting">
    <header>
        <h1 itemprop="headline">fluid interface effect</h1>
        <span class="muted">
    <svg style="margin-bottom:-3px" class="i-clock" viewBox="0 0 32 32"
         width="16" height="16" fill="none" stroke="currentcolor"
         stroke-linecap="round" stroke-linejoin="round" stroke-width="6.25%">
        <circle cx="16" cy="16" r="14"/>
        <path d="M16 8 L16 16 20 20"/>
    </svg>
    <span>3 minute read</span>
    <svg style="margin-bottom: -3px" class="i-edit" viewBox="0 0 32 32"
         width="16" height="16" fill="none" stroke="currentcolor"
         stroke-linecap="round" stroke-linejoin="round" stroke-width="6.25%">
        <path d="M30 7 L25 2 5 22 3 29 10 27 Z M21 6 L26 11 Z M5 22 L10 27 Z"/>
    </svg>

    Published: 2019-11-27
</span>
    </header>
    <div itemprop="articleBody">
      <p>wwdc2018 세션중 하나인 <a href="https://developer.apple.com/videos/play/wwdc2018/803/">Designing Fluid Interfaces</a> 를 직접 구현한 opensource중 button 구현에 대해 정리</p>
<ul>
<li><a href="https://github.com/nathangitter/fluid-interfaces">fluid-interfaces</a></li>
</ul>
<span id="continue-reading"></span><h3 id="ios-appjung-gyesangiaebyi-beoteungwa-gateun-hyogwa">ios app중 계산기앱의 버튼과 같은 효과</h3>
<ul>
<li>Button구현의 풀소스는 다음과 같다 </li>
</ul>
<pre data-lang="swift" style="background-color:#2b303b;color:#c0c5ce;" class="language-swift "><code class="language-swift" data-lang="swift"><span style="color:#65737e;">//
</span><span style="color:#65737e;">//  Button.swift
</span><span style="color:#65737e;">//  Example
</span><span style="color:#65737e;">//
</span><span style="color:#65737e;">//  Created by kwanghyun.won on 2019/11/07.
</span><span style="color:#65737e;">//  Copyright © 2019 vingle. All rights reserved.
</span><span style="color:#65737e;">//
</span><span>
</span><span style="color:#b48ead;">import </span><span>UIKit
</span><span>
</span><span style="color:#b48ead;">open class</span><span> Button: UIButton {
</span><span>    </span><span style="color:#b48ead;">private struct</span><span> Const {
</span><span>        </span><span style="color:#b48ead;">static let</span><span> borderWidth: CGFloat = </span><span style="color:#d08770;">1
</span><span>        </span><span style="color:#b48ead;">static let</span><span> cornerRadius: CGFloat = </span><span style="color:#d08770;">2
</span><span>    }
</span><span>
</span><span>    </span><span style="color:#b48ead;">open override var</span><span> intrinsicContentSize: CGSize {
</span><span>        </span><span style="color:#b48ead;">var</span><span> origSize = </span><span style="color:#b48ead;">super</span><span>.intrinsicContentSize
</span><span>        origSize.height = </span><span style="color:#b48ead;">self</span><span>.size == .large ? origSize.height + </span><span style="color:#d08770;">4</span><span>.</span><span style="color:#d08770;">0 </span><span>: origSize.height + </span><span style="color:#d08770;">2</span><span>.</span><span style="color:#d08770;">0
</span><span>        </span><span style="color:#65737e;">//dump(origSize)
</span><span>        </span><span style="color:#b48ead;">return</span><span> origSize
</span><span>    }
</span><span>
</span><span>    </span><span style="color:#b48ead;">open override func </span><span>tintColorDidChange() {
</span><span>        </span><span style="color:#b48ead;">super</span><span>.tintColorDidChange()
</span><span>        update()
</span><span>    }
</span><span>
</span><span>    </span><span style="color:#b48ead;">open var</span><span> style: ButtonStyle = .flat {
</span><span>        </span><span style="color:#b48ead;">didSet</span><span> {
</span><span>            </span><span style="color:#b48ead;">if</span><span> style != oldValue {
</span><span>                update()
</span><span>            }
</span><span>        }
</span><span>    }
</span><span>
</span><span>    </span><span style="color:#b48ead;">open var</span><span> size: ButtonSize = .large {
</span><span>        </span><span style="color:#b48ead;">didSet</span><span> {
</span><span>            </span><span style="color:#b48ead;">if</span><span> size != oldValue {
</span><span>                update()
</span><span>            }
</span><span>        }
</span><span>    }
</span><span>
</span><span>    </span><span style="color:#b48ead;">open override var</span><span> isHighlighted: Bool {
</span><span>        </span><span style="color:#b48ead;">didSet</span><span> {
</span><span>            </span><span style="color:#b48ead;">if</span><span> isHighlighted != oldValue {
</span><span>                update()
</span><span>            }
</span><span>        }
</span><span>    }
</span><span>
</span><span>    </span><span style="color:#b48ead;">open override var</span><span> isEnabled: Bool {
</span><span>        </span><span style="color:#b48ead;">didSet</span><span> {
</span><span>            </span><span style="color:#b48ead;">if</span><span> isEnabled != oldValue {
</span><span>                update()
</span><span>            }
</span><span>        }
</span><span>    }
</span><span>
</span><span>    </span><span style="color:#b48ead;">private var</span><span> animator = UIViewPropertyAnimator()
</span><span>    </span><span style="color:#b48ead;">private let</span><span> activationFeedBackGenerator = UIImpactFeedbackGenerator(style: .light)
</span><span>
</span><span>    </span><span style="color:#b48ead;">public init</span><span>(style: ButtonStyle = .flat, size: ButtonSize = .large) {
</span><span>        </span><span style="color:#b48ead;">self</span><span>.style = style
</span><span>        </span><span style="color:#b48ead;">self</span><span>.size = size
</span><span>        </span><span style="color:#b48ead;">super</span><span>.</span><span style="color:#b48ead;">init</span><span>(frame: .zero)
</span><span>        initialize()
</span><span>    }
</span><span>    
</span><span>    </span><span style="color:#b48ead;">public override init</span><span>(frame: CGRect) {
</span><span>        </span><span style="color:#b48ead;">super</span><span>.</span><span style="color:#b48ead;">init</span><span>(frame: frame)
</span><span>        initialize()
</span><span>    }
</span><span>
</span><span>    </span><span style="color:#b48ead;">public required init</span><span>?(coder aDecoder: NSCoder) {
</span><span>        </span><span style="color:#b48ead;">super</span><span>.</span><span style="color:#b48ead;">init</span><span>(coder: aDecoder)
</span><span>        initialize()
</span><span>    }
</span><span>
</span><span>    </span><span style="color:#b48ead;">open override func </span><span>layoutSubviews() {
</span><span>        </span><span style="color:#b48ead;">super</span><span>.layoutSubviews()
</span><span>        layer.cornerRadius = Const.cornerRadius
</span><span>        layer.borderWidth = style == .ghost ? Const.borderWidth : </span><span style="color:#d08770;">0</span><span>.</span><span style="color:#d08770;">0
</span><span>    }
</span><span>
</span><span>    </span><span style="color:#b48ead;">func </span><span>initialize() {
</span><span>        update()
</span><span>        NotificationCenter.</span><span style="color:#b48ead;">default</span><span>.addObserver(</span><span style="color:#b48ead;">self</span><span>, selector: #selector(didContentSizeCategoryDidChange),
</span><span>                                               name: UIContentSizeCategory.didChangeNotification, object: </span><span style="color:#d08770;">nil</span><span>)
</span><span>        addTarget(</span><span style="color:#b48ead;">self</span><span>, action: #selector(didTouchDown), </span><span style="color:#b48ead;">for</span><span>: [.touchDown, .touchDragEnter])
</span><span>        addTarget(</span><span style="color:#b48ead;">self</span><span>, action: #selector(didTouchUp), </span><span style="color:#b48ead;">for</span><span>: [.touchUpInside, .touchDragExit, .touchCancel])
</span><span>    }
</span><span>
</span><span>    </span><span style="color:#b48ead;">private func </span><span>update() {
</span><span>        setTitleColor(style.titleColor, </span><span style="color:#b48ead;">for</span><span>: .normal)
</span><span>        setTitleColor(style.hightlightTitleColor, </span><span style="color:#b48ead;">for</span><span>: .highlighted)
</span><span>        setTitleColor(style.disableTitleColor, </span><span style="color:#b48ead;">for</span><span>: .disabled)
</span><span>
</span><span>        </span><span style="color:#b48ead;">self</span><span>.backgroundColor = isEnabled ? style.backgroundColor : style.disableBackgroundColor
</span><span>
</span><span>        layer.borderColor = isEnabled ? style.titleColor.cgColor : style.disableTitleColor.cgColor
</span><span>
</span><span>        titleLabel?.font = size.titleFont
</span><span>        </span><span style="color:#b48ead;">let</span><span> lineHeight: CGFloat = (size == .large) ? </span><span style="color:#d08770;">22</span><span>.</span><span style="color:#d08770;">0 </span><span>: </span><span style="color:#d08770;">19</span><span>.</span><span style="color:#d08770;">0
</span><span>        titleLabel?.setLineHeight(lineHeight: lineHeight)
</span><span>
</span><span>        contentEdgeInsets = size.contentEdgeInsets
</span><span>    }
</span><span>
</span><span>}
</span><span>
</span><span style="color:#65737e;">// MARK: - event
</span><span style="color:#b48ead;">extension</span><span> Button {
</span><span>    </span><span style="color:#b48ead;">@objc private func </span><span>didContentSizeCategoryDidChange() {
</span><span>        update()
</span><span>    }
</span><span>
</span><span>    </span><span style="color:#b48ead;">@objc private func </span><span>didTouchDown() {
</span><span>        animator.stopAnimation(</span><span style="color:#b48ead;">true</span><span>)
</span><span>        backgroundColor = style.hightlightBackgroundColor
</span><span>        layer.borderColor = Colors.Button.borderHighlighted.cgColor
</span><span>        activationFeedBackGenerator.impactOccurred()
</span><span>    }
</span><span>
</span><span>    </span><span style="color:#b48ead;">@objc private func </span><span>didTouchUp() {
</span><span>        animator = UIViewPropertyAnimator(duration: </span><span style="color:#d08770;">0</span><span>.</span><span style="color:#d08770;">5</span><span>, curve: .easeOut, animations: {
</span><span>            </span><span style="color:#b48ead;">self</span><span>.backgroundColor = </span><span style="color:#b48ead;">self</span><span>.style.backgroundColor
</span><span>            </span><span style="color:#b48ead;">self</span><span>.layer.borderColor = Colors.Button.border.cgColor
</span><span>        })
</span><span>        animator.startAnimation()
</span><span>    }
</span><span>}
</span><span>
</span></code></pre>
<ul>
<li>위소스중 계산기 버튼과 같은 효과를 주기위한 효과는 </li>
</ul>
<pre data-lang="swift" style="background-color:#2b303b;color:#c0c5ce;" class="language-swift "><code class="language-swift" data-lang="swift"><span style="color:#b48ead;">private var</span><span> animator = UIViewPropertyAnimator()
</span><span style="color:#65737e;">///...
</span><span>
</span><span>    </span><span style="color:#b48ead;">@objc private func </span><span>didTouchDown() {
</span><span>        animator.stopAnimation(</span><span style="color:#b48ead;">true</span><span>)
</span><span>        backgroundColor = style.hightlightBackgroundColor
</span><span>        </span><span style="color:#65737e;">//..
</span><span>    }
</span><span>
</span><span>    </span><span style="color:#b48ead;">@objc private func </span><span>didTouchUp() {
</span><span>        animator = UIViewPropertyAnimator(duration: </span><span style="color:#d08770;">0</span><span>.</span><span style="color:#d08770;">5</span><span>, curve: .easeOut, animations: {
</span><span>            </span><span style="color:#b48ead;">self</span><span>.backgroundColor = </span><span style="color:#b48ead;">self</span><span>.style.backgroundColor
</span><span>            </span><span style="color:#b48ead;">self</span><span>.layer.borderColor = Colors.Button.border.cgColor
</span><span>        })
</span><span>        animator.startAnimation()
</span><span>    }
</span><span>
</span></code></pre>
<h2 id="flashlight-button-gwa-gateun-hwagdae-cugso-aenimeisyeongwa-jindong-feedback">flashlight button 과 같은 확대,축소 애니메이션과 진동 feedback</h2>
<pre style="background-color:#2b303b;color:#c0c5ce;"><code><span>위 버튼 구현 소스에는 확대,축소 애니메이션은 구현되어 있지 않다 
</span></code></pre>
<ul>
<li>진동 피드백 효과</li>
</ul>
<pre data-lang="swift" style="background-color:#2b303b;color:#c0c5ce;" class="language-swift "><code class="language-swift" data-lang="swift"><span>
</span><span>    </span><span style="color:#b48ead;">private let</span><span> activationFeedBackGenerator = UIImpactFeedbackGenerator(style: 
</span><span>    .light)
</span><span>    </span><span style="color:#65737e;">//...
</span><span>    </span><span style="color:#b48ead;">@objc private func </span><span>didTouchDown() {
</span><span>        activationFeedBackGenerator.impactOccurred()
</span><span>    }
</span></code></pre>
<ul>
<li>확대,축소 효과를 주려면 아래 코드를 추가하면 된다. </li>
</ul>
<pre data-lang="swift" style="background-color:#2b303b;color:#c0c5ce;" class="language-swift "><code class="language-swift" data-lang="swift"><span> </span><span style="color:#b48ead;">private func </span><span>animate() {
</span><span>        </span><span style="color:#b48ead;">let</span><span> timingParameters = UISpringTimingParameters(damping: </span><span style="color:#d08770;">0</span><span>.</span><span style="color:#d08770;">4</span><span>, response: </span><span style="color:#d08770;">0</span><span>.</span><span style="color:#d08770;">2</span><span>)
</span><span>        </span><span style="color:#b48ead;">let</span><span> animator = UIViewPropertyAnimator(duration: </span><span style="color:#d08770;">0</span><span>, timingParameters: timingParameters)
</span><span>        animator.addAnimations {
</span><span>            </span><span style="color:#b48ead;">self</span><span>.transform = CGAffineTransform(scaleX: </span><span style="color:#d08770;">1</span><span>, y: </span><span style="color:#d08770;">1</span><span>)
</span><span>            </span><span style="color:#b48ead;">self</span><span>.backgroundColor = </span><span style="color:#b48ead;">self</span><span>.isOn ? </span><span style="color:#b48ead;">self</span><span>.onColor : </span><span style="color:#b48ead;">self</span><span>.offColor
</span><span>        }
</span><span>        animator.isInterruptible = </span><span style="color:#b48ead;">true
</span><span>        animator.startAnimation()
</span><span>    }
</span></code></pre>

    </div>

    
        <footer>
            <hr>
            <p>
                
                    Published by Kwanghyun Won
                
                
                
                    and tagged
                    
                        <a href="https://wonkwh.github.io/tags/swift/">swift</a>
                        
                            
                                
                                    ,
                                
                            
                        
                    
                        <a href="https://wonkwh.github.io/tags/uikit/">uikit</a>
                        
                            
                                
                                    ,
                                
                            
                        
                    
                        <a href="https://wonkwh.github.io/tags/animation/">animation</a>
                        
                            
                                
                                    and
                                
                            
                        
                    
                        <a href="https://wonkwh.github.io/tags/wwdc/">wwdc</a>
                        
                            
                        
                    
                
            </p>
        </footer>
    
</article>


    </body>

</html>
