<!DOCTYPE html>
<html lang="en">
    <head>
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <meta http-equiv="content-type" content="text/html; charset=utf-8">

      <!-- Enable responsiveness on mobile devices-->
      <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

      <title></title>

      

      
          <link rel="stylesheet" href="https://wonkwh.github.io/site.css">
      

      
      
    </head>

    <body class="hack dark main container">
        

<article itemscope itemtype="http://schema.org/BlogPosting">
    <header>
        <h1 itemprop="headline">Building Better View</h1>
        <span class="muted">
    <svg style="margin-bottom:-3px" class="i-clock" viewBox="0 0 32 32"
         width="16" height="16" fill="none" stroke="currentcolor"
         stroke-linecap="round" stroke-linejoin="round" stroke-width="6.25%">
        <circle cx="16" cy="16" r="14"/>
        <path d="M16 8 L16 16 20 20"/>
    </svg>
    <span>4 minute read</span>
    <svg style="margin-bottom: -3px" class="i-edit" viewBox="0 0 32 32"
         width="16" height="16" fill="none" stroke="currentcolor"
         stroke-linecap="round" stroke-linejoin="round" stroke-width="6.25%">
        <path d="M30 7 L25 2 5 22 3 29 10 27 Z M21 6 L26 11 Z M5 22 L10 27 Z"/>
    </svg>

    Published: 2020-03-15
</span>
    </header>
    <div itemprop="articleBody">
      <p>Model, ViewModel 을 view로 보여주어야 할떄 <code>viewData protocol</code> 을 이용하여 일관적으로 view를 configure 하는 방법</p>
<ul>
<li>original article 
<ul>
<li><a href="https://www.fabisevi.ch/2019/12/26/building-better-views-part-i/">Building better view</a></li>
</ul>
</li>
</ul>
<span id="continue-reading"></span><h2 id="gaeyo">개요</h2>
<ol>
<li>A UIView instance. This is your standard view that you’ll be displaying in an app. It can be a regular class, or a custom subclass as you need.</li>
<li>A ViewData protocol. This is what’s going to keep track of the data that needs to be displayed in your view. Most commonly this will be a slice of a model, used specifically for rendering the view.</li>
<li>A configure(viewData: ViewData) function. This is what’s going to map your View to your ViewData.</li>
</ol>
<p><img src="https://fabisevi.ch//assets/img/view_data_diagram.png" alt="Diagram" /></p>
<h2 id="ilbanjeogin-guhyeon">일반적인 구현</h2>
<h3 id="api">API</h3>
<ul>
<li><code>itunes api</code> 를 이용하여 music track을 보여주는 예제 </li>
<li>IU의 음악을 검색하려면 다음과 같은 rest api 
<ul>
<li><code>https://itunes.apple.com/search?term=IU&amp;offset=0&amp;limit=20</code></li>
<li>깔끔히 보려면 요사이트를 이용하면 좋다 
<ul>
<li>https://jsonformatter.org/json-pretty-print</li>
</ul>
</li>
<li>결과는  아래와 같다 </li>
</ul>
</li>
</ul>
<pre data-lang="json" class="language-json "><code class="language-json" data-lang="json">{
  &quot;resultCount&quot;: 20,
  &quot;results&quot;: [
    {
      &quot;wrapperType&quot;: &quot;track&quot;,
      &quot;kind&quot;: &quot;song&quot;,
      &quot;artistId&quot;: 409076743,
      &quot;collectionId&quot;: 1438614238,
      &quot;trackId&quot;: 1438614348,
      &quot;artistName&quot;: &quot;IU&quot;,
      &quot;collectionName&quot;: &quot;Bbibbi - Single&quot;,
      &quot;trackName&quot;: &quot;Bbibbi&quot;,
      &quot;collectionCensoredName&quot;: &quot;Bbibbi - Single&quot;,
      &quot;trackCensoredName&quot;: &quot;Bbibbi&quot;,
      &quot;artistViewUrl&quot;: &quot;https:&#x2F;&#x2F;music.apple.com&#x2F;us&#x2F;artist&#x2F;iu&#x2F;409076743?uo=4&quot;,
      &quot;collectionViewUrl&quot;: &quot;https:&#x2F;&#x2F;music.apple.com&#x2F;us&#x2F;album&#x2F;bbibbi&#x2F;1438614238?i=1438614348&amp;uo=4&quot;,
      &quot;trackViewUrl&quot;: &quot;https:&#x2F;&#x2F;music.apple.com&#x2F;us&#x2F;album&#x2F;bbibbi&#x2F;1438614238?i=1438614348&amp;uo=4&quot;,
      &quot;previewUrl&quot;: &quot;https:&#x2F;&#x2F;audio-ssl.itunes.apple.com&#x2F;itunes-assets&#x2F;AudioPreview128&#x2F;v4&#x2F;12&#x2F;d9&#x2F;6b&#x2F;12d96b32-66b2-359c-b4d9-9d595b585a0d&#x2F;mzaf_6786449235518924873.plus.aac.p.m4a&quot;,
      &quot;artworkUrl30&quot;: &quot;https:&#x2F;&#x2F;is5-ssl.mzstatic.com&#x2F;image&#x2F;thumb&#x2F;Music118&#x2F;v4&#x2F;43&#x2F;cf&#x2F;eb&#x2F;43cfeb10-6da1-d6dd-1cc5-e1f461947052&#x2F;source&#x2F;30x30bb.jpg&quot;,
      &quot;artworkUrl60&quot;: &quot;https:&#x2F;&#x2F;is5-ssl.mzstatic.com&#x2F;image&#x2F;thumb&#x2F;Music118&#x2F;v4&#x2F;43&#x2F;cf&#x2F;eb&#x2F;43cfeb10-6da1-d6dd-1cc5-e1f461947052&#x2F;source&#x2F;60x60bb.jpg&quot;,
      &quot;artworkUrl100&quot;: &quot;https:&#x2F;&#x2F;is5-ssl.mzstatic.com&#x2F;image&#x2F;thumb&#x2F;Music118&#x2F;v4&#x2F;43&#x2F;cf&#x2F;eb&#x2F;43cfeb10-6da1-d6dd-1cc5-e1f461947052&#x2F;source&#x2F;100x100bb.jpg&quot;,
      &quot;collectionPrice&quot;: 1.29,
      &quot;trackPrice&quot;: 1.29,
      &quot;releaseDate&quot;: &quot;2018-10-10T12:00:00Z&quot;,
      &quot;collectionExplicitness&quot;: &quot;notExplicit&quot;,
      &quot;trackExplicitness&quot;: &quot;notExplicit&quot;,
      &quot;discCount&quot;: 1,
      &quot;discNumber&quot;: 1,
      &quot;trackCount&quot;: 1,
      &quot;trackNumber&quot;: 1,
      &quot;trackTimeMillis&quot;: 194425,
      &quot;country&quot;: &quot;USA&quot;,
      &quot;currency&quot;: &quot;USD&quot;,
      &quot;primaryGenreName&quot;: &quot;K-Pop&quot;,
      &quot;isStreamable&quot;: true
    },
    ...
</code></pre>
<h3 id="model">Model</h3>
<ul>
<li>필요한 필드만 빼서 만든 model object</li>
</ul>
<pre data-lang="swift" class="language-swift "><code class="language-swift" data-lang="swift">struct SearchResult: Decodable {
    let resultCount: Int
    let results: [Result]
}

struct Result: Decodable {
    let trackId: Int
    let trackName: String
    let primaryGenreName: String
    var averageUserRating: Float?
    var screenshotUrls: [String]?
    let artworkUrl100: String &#x2F;&#x2F; app icon
    var formattedPrice: String?
    var description: String?
    var releaseNotes: String?
    var artistName: String?
    var collectionName: String?
}

</code></pre>
<h3 id="view-guhyeon">view 구현</h3>
<ul>
<li>track list에 보여줄 cell view</li>
</ul>
<pre data-lang="swift" class="language-swift "><code class="language-swift" data-lang="swift">class ListCell: UICollectionViewCell {
    let imageView = AspectFitImageView(image: nil, cornerRadius: 16)
    let nameLabel = UILabel(text: &quot;TrackName&quot;, font: .boldSystemFont(ofSize: 18))
    let subtitleLabel = UILabel(text: &quot;Subtitle Label&quot;, font: .systemFont(ofSize: 16), numberOfLines: 2)

    override init(frame: CGRect) {
        super.init(frame: frame)

        hstack(
            imageView.withWidth(80),
            stack(nameLabel, subtitleLabel, spacing: 4),
            spacing: 16
        ).withMargins(.allSides(16))
    }

    required init?(coder aDecoder: NSCoder) {
        fatalError()
    }
}
</code></pre>
<ul>
<li>populate data </li>
</ul>
<pre data-lang="swift" class="language-swift "><code class="language-swift" data-lang="swift">    override func collectionView(_ collectionView: UICollectionView, cellForItemAt indexPath: IndexPath) -&gt; UICollectionViewCell {
        let cell = collectionView.dequeueReusableCell(withReuseIdentifier: cellId, for: indexPath) as! ListCell

        let track = results[indexPath.item]

        cell.nameLabel.text = track.trackName
        if let url = URL(string: track.artworkUrl100) {
            Nuke.loadImage(with: url, into: cell.imageView)
        }

        cell.subtitleLabel.text = &quot;\(track.artistName ?? &quot;&quot;) • \(track.collectionName ?? &quot;&quot;)&quot;
</code></pre>
<ul>
<li>full source code는 다음 repo 를 보며 된다. 
<ul>
<li>https://github.com/wonkwh/BlogShowcase/tree/master/BlogShowcase/BlogShowcase</li>
</ul>
</li>
</ul>
<h2 id="viewdata-protocol">viewData protocol</h2>
<ul>
<li>실제 cell에 보여줄 데이터 프로토콜을 정의하고 Model object의 extension으로 구현한다.</li>
</ul>
<pre data-lang="swift" class="language-swift "><code class="language-swift" data-lang="swift">protocol ResultViewData {
    var title: String { get }
    var subtitle: String { get }
    var albumCoverURL: URL? { get }
}


extension Result: ResultViewData {
    var title: String {
        return trackName
    }

    var subtitle: String {
        return &quot;\(artistName ?? &quot;&quot;) • \(collectionName ?? &quot;&quot;)&quot;
    }

    var albumCoverURL: URL? {
        return URL(string: artworkUrl100)
    }
}
</code></pre>
<ul>
<li>view cell에 extension 으로 <code>func configure(viewData: ..)</code> 를 구현</li>
</ul>
<pre data-lang="swift" class="language-swift "><code class="language-swift" data-lang="swift">extension ListCell {
    func configure(viewData: ResultViewData) {
        self.nameLabel.text = viewData.title
        self.subtitleLabel.text = viewData.subtitle
        if let url = viewData.albumCoverURL {
            Nuke.loadImage(with: url, into: self.imageView)
        }
    }
}

</code></pre>
<ul>
<li>populate data</li>
</ul>
<pre data-lang="swift" class="language-swift "><code class="language-swift" data-lang="swift">    override func collectionView(_ collectionView: UICollectionView, cellForItemAt indexPath: IndexPath) -&gt; UICollectionViewCell {
        let cell = collectionView.dequeueReusableCell(withReuseIdentifier: cellId, for: indexPath) as! ListCell

        let track = results[indexPath.item]
        cell.configure(viewData: track)

</code></pre>
<p>위와 같은 형태로 일관성있게 view model -&gt; view 로 구성할수 있다. </p>
<h2 id="camjo">참조</h2>
<ul>
<li>https://www.fabisevi.ch/2019/12/26/building-better-views-part-i/</li>
<li>https://fabisevi.ch//2019/12/26/building-better-views-part-ii</li>
</ul>

    </div>

    
        <footer>
            <hr>
            <p>
                
                    Published by Kwanghyun Won
                
                
                
                    and tagged
                    
                        <a href="https://wonkwh.github.io/tags/swift/">swift</a>
                        
                            
                                
                                    ,
                                
                            
                        
                    
                        <a href="https://wonkwh.github.io/tags/uikit/">uikit</a>
                        
                            
                                
                                    and
                                
                            
                        
                    
                        <a href="https://wonkwh.github.io/tags/viewmodel/">viewModel</a>
                        
                            
                        
                    
                
            </p>
        </footer>
    
</article>


    </body>

</html>
