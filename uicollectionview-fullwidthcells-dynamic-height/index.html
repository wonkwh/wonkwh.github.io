<!DOCTYPE html>
<html lang="en">
    <head>
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <meta http-equiv="content-type" content="text/html; charset=utf-8">

      <!-- Enable responsiveness on mobile devices-->
      <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

      <title></title>

      

      
          <link rel="stylesheet" href="https://wonkwh.github.io/site.css">
      

      
      
    </head>

    <body class="hack dark main container">
        

<article itemscope itemtype="http://schema.org/BlogPosting">
    <header>
        <h1 itemprop="headline">UICollectionView, full width cells, allow autolayout dynamic height</h1>
        <span class="muted">
    <svg style="margin-bottom:-3px" class="i-clock" viewBox="0 0 32 32"
         width="16" height="16" fill="none" stroke="currentcolor"
         stroke-linecap="round" stroke-linejoin="round" stroke-width="6.25%">
        <circle cx="16" cy="16" r="14"/>
        <path d="M16 8 L16 16 20 20"/>
    </svg>
    <span>3 minute read</span>
    <svg style="margin-bottom: -3px" class="i-edit" viewBox="0 0 32 32"
         width="16" height="16" fill="none" stroke="currentcolor"
         stroke-linecap="round" stroke-linejoin="round" stroke-width="6.25%">
        <path d="M30 7 L25 2 5 22 3 29 10 27 Z M21 6 L26 11 Z M5 22 L10 27 Z"/>
    </svg>

    Published: 2020-02-27
</span>
    </header>
    <div itemprop="articleBody">
      <p>CollectionView 를 이용해 tableview와 유사한 ListView를 사용하면서 tableview의 dynamic height와 같이 autolayout 기반의 dynamic height를 구현하는 코드</p>
<span id="continue-reading"></span><h3 id="collectionview-gibanyi-listcontroller">CollectionView 기반의 ListController</h3>
<pre data-lang="swift" class="language-swift "><code class="language-swift" data-lang="swift">import UIKit

extension UIView {
    func insect(by insect: UIEdgeInsets) {
        guard let superview = superview else {
            return
        }

        translatesAutoresizingMaskIntoConstraints = false

        leadingAnchor.constraint(equalTo: superview.leadingAnchor, constant: insect.left).isActive = true
        trailingAnchor.constraint(equalTo: superview.trailingAnchor, constant: -insect.right).isActive = true
        topAnchor.constraint(equalTo: superview.topAnchor, constant: insect.top).isActive = true
        bottomAnchor.constraint(equalTo: superview.bottomAnchor, constant: -insect.bottom).isActive = true
    }
}
class ListCell: UICollectionViewCell {
    let titleLabel: UILabel = {
        let label = UILabel()
        label.text = &quot;App Section Title&quot;
        label.font = UIFont.preferredFont(forTextStyle: .body)
        label.numberOfLines = 0
        label.textColor = .black
        return label
    }()


    override init(frame: CGRect) {
        super.init(frame: frame)
        contentView.backgroundColor = .green
        contentView.addSubview(titleLabel)
        titleLabel.insect(by: .init(top: 5, left: 5, bottom: 5, right: 5))
    }

    required init?(coder: NSCoder) {
        fatalError(&quot;init(coder:) has not been implemented&quot;)
    }
}

let items = [
        &quot;Lorem ipsum dolor sit amet.&quot;,
        &quot;Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris. Lorem ipsum dolor sit amet, consectetur adipiscing elit.&quot;,
        &quot;Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.&quot;,
        &quot;Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt.&quot;,
        &quot;Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.&quot;,
        &quot;Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt.&quot;,
        &quot;Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.&quot;,
        &quot;Lorem ipsum. Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris.&quot;
]

class ListController: UIViewController {
    lazy var collectionView: UICollectionView = {
        let layout = UICollectionViewFlowLayout()
        layout.scrollDirection = .vertical
        &#x2F;&#x2F;layout.itemSize = .init(width: self.view.frame.width, height: 80)
        layout.sectionInset = .init(top: 12, left: 0, bottom: 0, right: 0)
        let view = UICollectionView(frame: .zero, collectionViewLayout: layout)
        view.backgroundColor = .white
        view.register(ListCell.self, forCellWithReuseIdentifier: &quot;ListCell&quot;)
        view.dataSource = self
        view.delegate = self
        view.alwaysBounceVertical = true
        view.translatesAutoresizingMaskIntoConstraints = false
        return view
    }()

    override func viewDidLoad() {
        super.viewDidLoad()
        &#x2F;&#x2F;navigationController?.navigationBar.prefersLargeTitles = true
        navigationItem.title = &quot;ListController&quot;
        view.addSubview(collectionView)

        NSLayoutConstraint.activate([
            collectionView.topAnchor.constraint(equalTo: view.safeAreaLayoutGuide.topAnchor),
            collectionView.leadingAnchor.constraint(equalTo: view.safeAreaLayoutGuide.leadingAnchor),
            collectionView.trailingAnchor.constraint(equalTo: view.safeAreaLayoutGuide.trailingAnchor),
            collectionView.bottomAnchor.constraint(equalTo: view.safeAreaLayoutGuide.bottomAnchor)
        ])

    }
}

&#x2F;&#x2F; MARK: - UICollectionViewDataSource
extension ListController: UICollectionViewDataSource {
    func collectionView(_ collectionView: UICollectionView, numberOfItemsInSection section: Int) -&gt; Int {
        return 8
    }

    func collectionView(_ collectionView: UICollectionView, cellForItemAt indexPath: IndexPath) -&gt; UICollectionViewCell {
        let cell = collectionView.dequeueReusableCell(withReuseIdentifier: &quot;ListCell&quot;, for: indexPath) as! ListCell
        cell.titleLabel.text = items[indexPath.item]
        return cell
    }
}

extension ListController: UICollectionViewDelegateFlowLayout {
    func collectionView(_ collectionView: UICollectionView, layout collectionViewLayout: UICollectionViewLayout, sizeForItemAt indexPath: IndexPath) -&gt; CGSize {
        return .init(width: self.view.frame.width, height: 80)
    }
}

</code></pre>
<ul>
<li><code>UICollectionViewDelegateFlowLayout</code>  의 sizeForItemAt method를 오버라이드하여 width를 full width로 설정하면 된다.</li>
<li>하지만 height를 위와 같이 80으로 고정하면 contents내용에 따라 동적으로 height를 구성하기 꽤 빡시다.
<img src="https://user-images.githubusercontent.com/911787/75467624-493c1c80-59cf-11ea-8c3e-8c472f142319.png" alt="no_dynamic_height" /></li>
</ul>
<h3 id="solution">Solution</h3>
<ul>
<li>참조 링크를 보면 꽤 다양한 방법들이 존재하나 가장 심플한 방법</li>
<li><code>UICollectionViewDelegateFlowLayout</code> 관련 코드를 삭제</li>
</ul>
<pre data-lang="swift" class="language-swift "><code class="language-swift" data-lang="swift">    lazy var collectionView: UICollectionView = {
        let layout = UICollectionViewFlowLayout()
        ...
        view.delegate = self &#x2F;&#x2F; 요 라인만 삭제
        ...
    }()

...
extension ListController: UICollectionViewDelegateFlowLayout {
    func collectionView(_ collectionView: UICollectionView, layout collectionViewLayout: UICollectionViewLayout, sizeForItemAt indexPath: IndexPath) -&gt; CGSize {
        return .init(width: self.view.frame.width, height: 80)
    }
}
</code></pre>
<ul>
<li>다음 코드를 추가
<ul>
<li>
<p>ListCell 에 width anchor를 추가한다.</p>
<pre data-lang="swift" class="language-swift "><code class="language-swift" data-lang="swift">class ListCell: UICollectionViewCell {
    ...
  override init(frame: CGRect) {
      super.init(frame: frame)
      contentView.backgroundColor = .green
      contentView.addSubview(titleLabel)
      &#x2F;&#x2F;하단 라인 추가
      titleLabel.widthAnchor.constraint(equalToConstant: UIScreen.main.bounds.size.width - 10).isActive = true
      titleLabel.insect(by: .init(top: 5, left: 5, bottom: 5, right: 5))
  }

}
...
</code></pre>
</li>
<li>
<p>ListController 에 <code>itemSize</code> ,<code>estimatedItemSize</code> 를 추가</p>
<pre data-lang="swift" class="language-swift "><code class="language-swift" data-lang="swift">lazy var collectionView: UICollectionView = {
    let layout = UICollectionViewFlowLayout()
    ...
    &#x2F;&#x2F; 하단 두라인 추가

    layout.itemSize = UICollectionViewFlowLayout.automaticSize
    layout.estimatedItemSize = UICollectionViewFlowLayout.automaticSize

    ...
}()
...
</code></pre>
<p><img src="https://user-images.githubusercontent.com/911787/75467646-50632a80-59cf-11ea-9023-5f233f0ce146.png" alt="dynamic_height" /></p>
</li>
</ul>
</li>
</ul>
<h3 id="camjo">참조</h3>
<ul>
<li><a href="https://stackoverflow.com/questions/44187881/uicollectionview-full-width-cells-allow-autolayout-dynamic-height">https://stackoverflow.com/questions/44187881/uicollectionview-full-width-cells-allow-autolayout-dynamic-height</a></li>
</ul>

    </div>

    
        <footer>
            <hr>
            <p>
                
                    Published by Kwanghyun Won
                
                
                
                    and tagged
                    
                        <a href="https://wonkwh.github.io/tags/swift/">swift</a>
                        
                            
                                
                                    ,
                                
                            
                        
                    
                        <a href="https://wonkwh.github.io/tags/uikit/">uikit</a>
                        
                            
                                
                                    ,
                                
                            
                        
                    
                        <a href="https://wonkwh.github.io/tags/uicollectionview/">uicollectionview</a>
                        
                            
                                
                                    and
                                
                            
                        
                    
                        <a href="https://wonkwh.github.io/tags/autolayout/">autolayout</a>
                        
                            
                        
                    
                
            </p>
        </footer>
    
</article>


    </body>

</html>
